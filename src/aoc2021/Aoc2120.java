package aoc2021;

public class Aoc2120 {
    public static void main(String[] args) {
        var steps = 50;
        var render = true;
        var size = 500;
        var mid = size / 2;
        var input = getInput();

        var codebook = input[0];
        var initimg = input[1].split("\n");

        var data = new int[size][size];

        for (var i = 0; i < initimg.length; i++) {
            for (var j = 0; j < initimg[i].length(); j++) {
                data[mid + i][mid + j] = initimg[i].charAt(j) == '#' ? 1 : 0;
            }
        }

        var r = 0;

        for (var step = 0; step < steps; step++) {
            var newimg = new int[size][size];
            for (var i = 0; i < data.length; i++) {
                for (var j = 0; j < data[i].length; j++) {
                    var keystr = "";
                    for (var ii = i - 1; ii < i + 2; ii++) {
                        for (var jj = j - 1; jj < j + 2; jj++) {
                            if (ii < 0 || jj < 0 || ii >= data.length || jj >= data[i].length) {
                                keystr += data[i][j] == 1 ? "1" : "0";
                            } else {
                                keystr += data[ii][jj] == 1 ? "1" : "0";
                            }
                        }
                    }
                    var idx = Integer.parseInt(keystr, 2);
                    newimg[i][j] = codebook.charAt(idx) == '#' ? 1 : 0;
                }
            }
            data = newimg;
        }

        for (var i = 0; i < data.length; i++) {
            for (var j = 0; j < data[i].length; j++) {
                if (data[i][j] == 1) r++;
            }
            System.out.println();
        }

        if (render) {
            for (var i = 0; i < data.length; i++) {
                for (var j = 0; j < data[i].length; j++) {
                    System.out.print(data[i][j] == 1 ? '#' : ' ');
                }
                System.out.println();
            }
        }

        System.out.println(r);
    }

    private static String[] getInputex() {
        return ("..#.#..#####.#.#.#.###.##.....###.##.#..###.####..#####..#....#..#..##..##" +
            "#..######.###...####..#..#####..##..#.#####...##.#.#..#.##..#.#......#.###" +
            ".######.###.####...#.##.##..#..#..#####.....#.#....###..#.##......#.....#." +
            ".#..#..##..#...##.######.####.####.#.#...#.......#..#.#.#...####.##.#....." +
            ".#..#...##.#.##..#...##.#.##..###.#......#.#.......#.#.#.####.###.##...#.." +
            "...####.#..#..#.##.#....##..#.####....##...##..#...#......#.#.......#....." +
            "..##..####..#...#.#.#...##..#.#..###..#####........#..####......#..#\n" +
            "\n" +
            "#..#.\n" +
            "#....\n" +
            "##..#\n" +
            "..#..\n" +
            "..###").split("\n\n");
    }

    private static String[] getInput() {
        return ("###..##....#....##...#.#.#...######.#.#.#.###.####.....#.##...###......###.......#.#.#...##.##...#.#####..#.#.#.###..####..#.#..#..#...###.####..#.###.#...#.#.#.#...#.....#####..#.##.#.#.#.#...####.#.#....##..######..###.####......#..#..#####.##.#.#.#.#.####...###.####..#.#.#..##...#..#..#..##..##..###..#..#####.##...#.#.....##.#..##.#...####.#...#..##.#.#....#..#....##.#.#.###.#..#.###.###.######.##.######...#..##..##.#.###..#.###..#..#.########.###.#.#.#.#..##.#.#.###.#.###.#.#.###...#..#.##....##.##.##..\n" +
            "\n" +
            ".....#...#.####...#####..##..#.##.######...###.##.#.#.#...#####.#.#........#.######.#.#.##..####..#.\n" +
            "##.#...##...######...##..####..####..#...##.#..##.#.##.#.....##.##.#.##...#####..#..#....#.###...###\n" +
            "..#.##...#..#.....#..##.##...###..##..##....##...#..####.#....#.#.##.#.#.#..#.#.##..##.##.###.##..##\n" +
            "......##.##.#.#.#....#..##.###.##.#.###..###.###....#...##.####.#.####.###..#..##.#.###....#.#..#.#.\n" +
            "#.#...##.######.#..###..#.....##....####.#..###.##.#...#.#.#.#..####..#.#....#.#........#.#..#...##.\n" +
            ".#.#####..##..###########.#..##.#..#####.#.#.###..#..##.##.#.#...#..##.#####...#.......#....#....###\n" +
            "..#..#.##.#..##...##.#.#...###.#...#..##.##..####.#.#........##.#....#..###...##.#.#####.#...#..#.#.\n" +
            ".###...###.#..#.##.#.##..#.#####.#.#...#.###.#...###.#...#....##.#..#.#####..##.#.###.#.....#..#.#..\n" +
            "###...##..###.##...#..##...##.##..##.#..#.####.#.#.##..##.#..#.......##.#....####.#.####..###..#...#\n" +
            ".#.....#.#.####..#.##.##..#######.##.###.#...#..#.##..#....#..####.#.#....#.#..#.#....##..#####..#.#\n" +
            ".#.#..#..##..#..##.#........#...###..###.#...#.#...##..###...#.####..#####.####..#..##.##.####...###\n" +
            "##.#....##.#.#..#.##.##.#.#...#.##.#.#....##.#.##.#.#####..#.#....#.###..#.#....###......####.######\n" +
            "##..###.#.#.##.###...#.#.......#.#.##..##..####...#.###.##.##.#.#..###.##..##.#......##.###.....##..\n" +
            ".#########..##..##.##.#.##..#.#######.#.#..######..###...##....####.#......###.####.#.#..####.###..#\n" +
            "....###.####..#.#.....#...#......##.##.###.#.#.###..#.###..#..###....#.##.#.##.#.#..###..#..##..#.##\n" +
            "#..#.#..#.#..##..##.####....##..#..#.####.#.#.#..##.##...#.###.##...###.#####..####.####..#..#####.#\n" +
            "..#.......##....#.##...#.##...####..##...#.##..#.....#.######..##.#.#..##.##..##..#...#####..#...#..\n" +
            "....#.#.###.##..#..###..#.#..#.###.##....#..#.##.##..##.#.####..####....##..####.#.##.#.#.######..##\n" +
            "#.##.####.#####..####..##..###.########.#.#.#...##..#..#.#..#..#..###.##...##....#.#.##.#####....##.\n" +
            "#.#..#.#.#..#.#.#.....#..#..#.####.##########.###.#....##.#.###.#.##.....#....#..##.###.###.#...###.\n" +
            ".##.###.######.....#####.......###.#######.#....#.##..##...#...###.##.##.#..####....##.#..#.##.#.#.#\n" +
            ".####..#.##.#.#...#.....###.....##..###.#.#.#..####..##..#.#######.#.#.##.######.##...###...#.#..#..\n" +
            ".##.#..#.#.##..#..##.#..#...#...##...###...#.#.####.#...###...#.#.....####......#.######..####.#.###\n" +
            "##..#.###..###....##.####.###..#..#.##.####.#.#.##..###..#.#.#..#..######...####...#..##.##..##..#.#\n" +
            "##.#...#######.####.#.##.##.#.##...#.#...#.##.####.#.##.#..#.###......##.#.#.#...###.#...##..##.###.\n" +
            "..###.#.##.#.#....##.#.###....##.#....##.##.#...##.#.#...###..#.#........#####..#####...##..#.#...#.\n" +
            "##.....#...#.#...#....####..#.####.#.#......##....#...####..#.##..####..#.#.####.##.##.#.##.#####.#.\n" +
            "....######....#..###.###..#..#####.###....#.##...#...#.#..#.....#.#####.##...##..###.##.#..#.####.##\n" +
            ".##..###.#.#.#####...###.##.###.#.##..##..#..#.##.##....##..##...##.####..#.####...##.##.##...#..#..\n" +
            "#.#..#####.#.#####...#.#..#...#.#.###...##.#.######....##....##.#..#.##.##.###..##.##.#####.#...##.#\n" +
            "#..###.###.#.#####.#..#......#.#.##.###..##.#...###..####.#..#####...##.####.#...##.#.###.##...###.#\n" +
            "###.###..####.#.#....#...#..##...#.###..#..#####.###.#.#.#..#..#.##...###.#.#.####.#.###..##..##.##.\n" +
            ".#.#..#.#.#..#....##.#....#...#..#.#....###.#.#......##..##..#..###......##.####.#########....##...#\n" +
            "#.....#.....##..##..###.##.##..####....#..#.##.##.#..##.##.#..####..#....####.#.#...##.#.#.###.#.##.\n" +
            ".#..##.###.##..#..##..#.#..####......#..###.##..##...##..#....###.#.#.....###.##.##..##....#.#.##...\n" +
            ".#...##.....#####.###..#...#.#.#...........#.##.#.......#.####...###.##..#..##.#...#..#########...#.\n" +
            "########.####.##.......#.##.###.##.#.####.#..##.##.#.###..##.####..#..##.#..#...#.###......##.##.###\n" +
            ".#.##...#.#######.###.#.######.#..###.#..##.#..##.###..##.#.##....####...#..##..#....#.#.##.#.##.#.#\n" +
            "...#.#.#..##..##.#..####....##....#..#.#.#.##.#..#.#..#...####......##.....#.#.#..##...#..#.#..#...#\n" +
            ".#.#####.#.#.#####.#####....##..##....####..#.###.#...###.#.##.#.#..##.#......#.###..#####....#..##.\n" +
            ".#.###..####..###.###...#...#.###.#.##.##.##...#.....##.##..##..######.#.##.#.######..#.#.#.......#.\n" +
            "#.....##.#..#.....#.##.##..#.#.###..##.##.##.#..#.#...#.#...##.....#.##.#.####.#.##.##.#.##.#..#.#..\n" +
            ".#.#...#.##.##.#.#...#......##.#....#####.###.###.######..#.##.#..#.#..####..####.###..#.#....#..#.#\n" +
            ".##.#..####.#...####..#..##.##.###..#..######..##.####....#..#.##..###..##.##.......#.##..##..###..#\n" +
            "#....##.#.#.#...#.#..#...##.#.........##.#######..####.##..##.#####.##.#....##..#.####..###.####.#..\n" +
            "#####...#.###.####.##....##.####.#...###.##...#...#####..#...#.....###..#.#.#.##..#....#.#.#.#..###.\n" +
            "...#.#..####..##..##..#.###.......#..#.#..#...##....#...##.##.####..#...#.#...##.#..#.#.##...#.#.###\n" +
            "##.#.#...####.###..##...#...##.####.#..#..#.###.##..##..######.##.#.##.#.##.##.#...##...###.#.#.#.#.\n" +
            "....#....#.#.#.....#..###...#.####.#..#.###..#######..#.#...####...#...##...#.#..##.#.#..##.####.###\n" +
            "..##.#..#.....#.....#.##.#.#.##.#####.##....###.#.##.....##.#...###.#.#..#....#..#####.#.##.##.#.##.\n" +
            "###..##.#.#..##.##.##..##.....###.#.#..#.##....#...##..###.##.#...#.#.#.####.#..####...#.##.###..#..\n" +
            "#....#.##..##.#..##...#.#.##..#.#..#..##.#....#.##....####..........##.##.....######.##...#.......#.\n" +
            "#..#.##.###..##.#..#..#....#.####.#.....###.###....##...##..#..##.#####..#.#..########..#...####.#.#\n" +
            "###.#..##....###.#..##..###.##.#..#....####....#.#.....#.#.#######.###.#.#.##.######....#.#.#....##.\n" +
            "...#.##.###.##...##.####..#.###.##..#.#.###..###..#..#....###.###....##.....#..##..#..#.............\n" +
            "..#...###...#####.###.###.##.....###....#....###.###...#.#.#.#.##.#..#..####.#....#...#.#..#.##.####\n" +
            "#####....#.....#...###..#.#....#..#.###..#.####........###.##.#........###.#.##...##..#..#.##.#....#\n" +
            ".####.#..##.#.##.######.......#.#.#...#..#.#..#....#.##..#...#.#######....####.#..##.#..##..##.###..\n" +
            ".#.##...#.##...#..#..#..###..#.#.......#.##..#.#..#.###..##.....#.#.#######.....##..#.##.#.###.#.##.\n" +
            "..##.#...##.###.##.#.#......##..##...##...###.#.##..#...#.#.####...#..##.#..#.##..##....#.##....###.\n" +
            "#..############.#.#..#.##.##..#...#.......##.##..#.#..#..###....####...###.#.###..####.#.#.#..#..##.\n" +
            ".#..#...#.##.##.#.##..#.##.###.....#..##...#.##......#.....##.#.##.##....####...#....##..##.####.##.\n" +
            "#.###...##..#.##.##.######.#######.##..####.#..#.###.#.##...#.......#.######....###.#....##.#.##.#..\n" +
            "#.##.........###....####.###.#.###.#....#.##.##.#.###...#.###..#.##.####.#######.###.#.##.##....#..#\n" +
            "##..#.##...##.#..###.#.##.#..##...#....###.###.#..#.##....#.###...#.#.#...#####..#....#..####.#.###.\n" +
            "#.####.#..#.####.###.######.##..#.#...#.####..#...###.#...#.####.....###..#..#..#..###.#.##.###.#..#\n" +
            "#.##.#.######.##.#.#.#.#.#....#...#...##.####.###.##.#..###....#........#...###.#.#..#.##..####..##.\n" +
            "...####.#.#.#.###........#####.###...#..#.#.......#....#..##.#.#.##.###...######..###.#...#.##.##.##\n" +
            ".#..#.####.#..#.#....##..###.##..##.####..###....#.#..######...######.##.#.#.#.##.#....#.......##..#\n" +
            "...###..#####......#.###..#...#...#.##.###.##...#.....###########....##..##...#.#...#.....##.#..#.##\n" +
            "#.........#.##.#.#....#......#..#.##.#..####...#..#.###.##.####...#..##.#.##.#.#.##.#.##...#.#.#.###\n" +
            ".#.#..#....#......#.#.#.......#...#..#.#..##..#####.#.#.#####.....#..#####.#..#..##.#.#####..#.#...#\n" +
            "...#.#..#.##...#.#..#.##.##.##..#..#####.....#.###...##.#..#..#.....###.#.##..#.####.###.#..#..###.#\n" +
            ".#.########.#.###..#....#.#####...######.#####.#..#.#####.#....#.....###..#..###.###.#..####..#....#\n" +
            "####.#.#.####.#.#..###.##.....#.####..##.#..#....#.####.###.##....#####.#.##.#.##.......#.#.#..#.#..\n" +
            "######..##.#...#.#.#####..#....#..#...###..#.#..##....#..##.....######..###.##.#.#.####.#.#...#..###\n" +
            ".##......########.#..#.####.....####.#.###....##..##..##..#.##.#..#.##.###....##.#.....#.#.#.##...#.\n" +
            "###.#...#...##...#.####.###.###.#..#..#..#.###...#..####..####.#.#...##..#############.#..#......#.#\n" +
            "#.##.#...#.######.####...#.#.#.#.#.######.#..####..#....##..###..#..#.###..#....##.##.#...####.#.#.#\n" +
            ".....#.###.#...###..##.###.#.###.#....###....#..##.#.##..##.#####..##.######.#..##.##..#.#.##.#..#..\n" +
            "##..##.......#..####..##.#..#..#.##.#.#...#.....#.###...#.#....#.....#...#.#.#...##..#####.#.#.....#\n" +
            "..###...#.....##..#.#.##..#...######...#...##.#..#.####...#.#......##.####..#..#####.#.###...#..##..\n" +
            "###.#.#.....#..#.#..##.###...##.###..#...###.#.#..####...##..#.###..###.#...##.####.......##.##.....\n" +
            "##.#.#.#.#.......####.##..###.###..######..##.#...#..###..##.#..###.##....###..###.##....####.##..##\n" +
            ".#..#####..#..###......##.#..##.......###.#.#......##.##.##.####.#..#####.#####.#.....#..#..#.#..#.#\n" +
            "...##.#.####.#...##.####..##.######.####.###...##...#.#..#####.....##.##...#.########.#..##.#..#.###\n" +
            "#.##..#.##........#.#.##..#####..##.....##.#.###..######.###.#.#.....##..#........#....#.##.##......\n" +
            "##..#...#.####.#..####..###...#.#..#.....##.##.###...#.##.....#....#....####.#..####...#.###..#.#.#.\n" +
            "###.#.###...#.######....###..#...#.#..#....####.#.####..#.#.#.##.###..#..##..#.###.##.##....####...#\n" +
            "#.##.#.#...##.....##.#..##....######....######.#.##.#...##.#.......#...##..##..##..###..#....####.#.\n" +
            "###.###..#.##.##.....#..#.#..###..###....#...####.#######.##.##.#..###.###.#.###.#.........####..##.\n" +
            "..###...####..#.##..####.##...##...#.####..#...#..#..####.##.#..#.....##..####.......#.#...##..##..#\n" +
            "###..#.#.##.#.#..###....##.###..##.#####....####...###.#.#..#.##.#...#..#######..#.#.#.##.###....###\n" +
            "#....###...#....#...###.#.##.#....###...#####...#.#......#.##.##.#....###...#.#.#.#.#.#..###..#.####\n" +
            "..###...#.######.#..#..##.#....#####..####..###.#...####..#.#.#....#..#..###.#.##.....######.#..#..#\n" +
            "##...#.##.#.##.###.#.#.##.###..###.####.####...#.###.####.##......#.#..#.###..#......#.#.....#######\n" +
            ".#.#..#..#..#.##...####...#...#.....##.#.##..###.##.##.#.#.##..#.##...###...###...##..####.#.###.#.#\n" +
            "..#...##.#.#.#.#..#####.####.#...##...#.#..####.....#.##..#.....#.#####.##...###..###....#.##...#..#\n" +
            "##...#...##.###.#.###...#..##..##.##..#.....##.###..#...##....###.#.##.#.#...###....#.##.###.####...\n" +
            "###...##.###.##........####...#.......##..###.##..#..####....###.#.###...#...###.#.#.#.###........#.").split("\n\n");
    }
}
